<!DOCTYPE html>
<html>
  <head>
    <title>Appartment Scraper</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIwzALxUPNbatRBj3Xi1Uhp0fFzwWNBkE&callback=initMap&libraries=&v=weekly"
    defer
  ></script>
  <link rel="stylesheet" href="style.css">
<script>    
async function initMap() {

  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 15
  });

  let allInfos = [ { title:
     'Très grand logement superbe vue sur le fleuve, 4 chambres,libre',
    address: '656 Champlain, Québec, QC, G1K 4J3',
    price: '1200.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/tres-grand-logement-superbe-vue-sur-le-fleuve-4-chambres-libre/1539483833' },
  { title: 'SUPERBE 6 ½ MONTCALM / ENTIÈREMENT RÉNOVÉ / DERNIER ÉTAGE',
    address: '1046 Avenue des Érables, Québec, QC G1R 2M9, Canada',
    price: '1650.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/superbe-6-montcalm-entierement-renove-dernier-etage/1526087669' },
  { title: '9 1/2 Bougainville/ Grande Allée (Montcalm)- Stationnement',
    address: '636-640, Grande Allée Ouest, Québec, QC, G1S 1B8',
    price: '2200.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/9-1-2-bougainville-grande-allee-montcalm-stationnement/1539302133' },
  { title: 'Grand 6 1/2 Grande Allée (Montcalm)- Face aux Plaines',
    address: 'Grande Allée Ouest, Québec, QC, G1S 1B6',
    price: '2100.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/grand-6-1-2-grande-allee-montcalm-face-aux-plaines/1539302127' },
  { title: 'Cession de bail - 1er Février - 6 ½ à Montcalm',
    address: '919 Avenue de Manrèse, Québec, QC G1S 2W9, Canada',
    price: '1210.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/cession-de-bail-1er-fevrier-6-a-montcalm/1539267107' },
  { title:
     'Grand 6 1/2 Chauffé Haute-Ville, 3 chambres et balcon, repeint.',
    address: '472 Ch Ste-Foy, Québec, QC G1S 2J5, Canada',
    price: '1180.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/grand-6-1-2-chauffe-haute-ville-3-chambres-et-balcon-repeint/1538964152' },
  { title: 'Grand 6 1/2 Grande Allée (Montcalm)- Face aux Plaines',
    address: 'Grande Allée Ouest, Québec, QC, G1S 1B6',
    price: '2100.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/grand-6-1-2-grande-allee-montcalm-face-aux-plaines/1538944114' },
  { title: '9 1/2 Bougainville/ Grande Allée (Montcalm)- Stationnement',
    address: '636-640, Grande Allée Ouest, Québec, QC, G1S 1B8',
    price: '2200.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/9-1-2-bougainville-grande-allee-montcalm-stationnement/1538944123' },
  { title:
     '6 1/2 à louer :Quartier Saint-Sauveur à partir du 1 janvier 2021',
    address: '540 Rue Boisseau, Québec, QC G1N 1X2, Canada',
    price: '1300.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/6-1-2-a-louer-:quartier-saint-sauveur-a-partir-du-1-janvier-2021/1538801738' },
  { title: 'Très grand 6 1/2, libre immédiatement ',
    address: 'Rue Signaï, Québec, QC G1K 5L8, Canada',
    price: '895.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/tres-grand-6-1-2-libre-immediatement/1538472552' },
  { title: '6 1/2 Chauffé , repeint, fenetre neuve, dispo Mois Gratuit',
    address: '472 Ch Ste-Foy, Québec, QC G1S 2J5, Canada',
    price: '1180.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/6-1-2-chauffe-repeint-fenetre-neuve-dispo-mois-gratuit/1538287994' },
  { title: 'APPARTEMENT VIEUX-QUÉBEC - 1er JANVIER AU 1er JUILLET',
    address: '6 Rue Couillard, Québec, QC G1R, Canada',
    price: '340.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/appartement-vieux-quebec-1er-janvier-au-1er-juillet/1537483368' },
  { title:
     '6 1/2 à louer -Quartier Saint-Sauveur à partir du 1 janvier 2021',
    address: '540 Rue Boisseau, Québec, QC G1N 1X2, Canada',
    price: '1300.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/6-1-2-a-louer-quartier-saint-sauveur-a-partir-du-1-janvier-2021/1537199615' },
  { title:
     'Maison à louer quartier Montcalm, meublé, tout inclus, un bijou!',
    address: '171 Boulevard René Levesque Ouest, G1R 2A6, Québec, QC',
    price: '2000.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/maison-a-louer-quartier-montcalm-meuble-tout-inclus-un-bijou/1536604351' },
  { title: 'Fraîchement rénové! Maison sur 2 étages',
    address: '656 Rue Champlain, Québec, QC G1K 4J3, Canada',
    price: '1200.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/fraichement-renove-maison-sur-2-etages/1534710223' },
  { title: '6 1/2 meublé, TOUT INCLUS, à LOUER, Montcalm',
    address: 'Quebec City, QC G1R, Canada',
    price: '1850.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/6-1-2-meuble-tout-inclus-a-louer-montcalm/1506515518' },
  { title: 'Appartement',
    address: '572 Rue D\'Aiguillon, Québec, QC G1R 1M3, Canada',
    price: '940.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/appartement/1533519455' },
  { title:
     'Superbe Apt Quartier Montcalm, Centre de la ville de Québec',
    address: '51 Grande Allée E, Québec, QC G1R 2G6, Canada',
    price: '1640.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/superbe-apt-quartier-montcalm-centre-de-la-ville-de-quebec/1533409539' },
  { title: 'APPARTEMENT 6-1/2 VIEUX-QUÉBEC À LOUER',
    address: '6 Rue Couillard, Québec, QC G1R, Canada',
    price: '340.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/appartement-6-1-2-vieux-quebec-a-louer/1533184855' },
  { title: 'Condo 8-1/2 à louer 1er décembre',
    address: '940 avenue de Bourlamaque , Québec G1R 2N8 QC',
    price: '1690.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/condo-8-1-2-a-louer-1er-decembre/1532714994' },
  { title:
     'GRAND APPARTEMENT LUMINEUX À LOUER DANS MONTCALM, Ville de QC',
    address: '477 Boulevard René-Lévesque O, Québec, QC G1S 1S2, Canada',
    price: '1650.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/grand-appartement-lumineux-a-louer-dans-montcalm-ville-de-qc/1530607459' },
  { title: 'Apartement 6 1/2 - Bienvenu Snow bird 2020',
    address: '263 8e Rue, Québec, QC G1L 2N8, Canada',
    price: '1295.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/apartement-6-1-2-bienvenu-snow-bird-2020/1504696843' },
  { title:
     'MONTCALM:8 1/2 Superbe Grand Condo 2 niveaux 4 chambres 1700p.c',
    address: '940 Avenue de Bourlamaque, Québec, QC G1R 2N8, Canada',
    price: '1690.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/montcalm:8-1-2-superbe-grand-condo-2-niveaux-4-chambres-1700p-c/1529660749' },
  { title: 'logement Montcalm pres du grand theatre',
    address: 'Quebec City, QC G1R2B1, Canada',
    price: '1145.00',
    link:
     'kijiji.ca/v-appartement-condo/ville-de-quebec/logement-montcalm-pres-du-grand-theatre/1529197284' } ]

  const geocoder = new google.maps.Geocoder();

for (let infos of allInfos){
    await geocode(infos, map, geocoder);
}

}


const delay = time => new Promise(res=>setTimeout(res,time));

async function geocode(infos, map, geocoder) {
    geocoder.geocode({ address: infos["address"] }, (results, status) => {
    if (status === "OK") {
      const contentString =
        '<div id="content">' +
        '<div id="siteNotice">' +
        "</div>" +
        '<h1 id="firstHeading" class="firstHeading">' + infos["title"] + '</h1>' +
        '<div id="bodyContent">' +
        "<p> Price: " + infos["price"] + "</p>" +
        '<p><a href="https://' + infos["link"] + '">Link</a></p>' +
        "</div>" +
        "</div>";

      const infowindow = new google.maps.InfoWindow({
        content: contentString,
       });

      const marker = new google.maps.Marker({
        map: map,
        position: results[0].geometry.location,
        title: infos["title"]
      });

      marker.addListener("click", () => {
        infowindow.open(map, marker);
      });

 
    } else {
    alert(
        "Geocode was not successful for the following reason: " + status
    );
    }
    map.setCenter(results[0].geometry.location);
  }); 
  await delay(1000);
}
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
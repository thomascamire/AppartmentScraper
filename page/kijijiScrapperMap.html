<!DOCTYPE html>
<html>
  <head>
    <title>Info Windows</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIwzALxUPNbatRBj3Xi1Uhp0fFzwWNBkE&callback=initMap&libraries=&v=weekly"
    defer
  ></script>
  <link rel="stylesheet" href="style.css">


    <script>    
 // This example displays a marker at the center of Australia.
// When the user clicks the marker, an info window opens.
async function initMap() {
  const uluru = {
    lat: -25.363,
    lng: 131.044
  };

  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 15
  });

  const contentString =
    '<div id="content">' +
    '<div id="siteNotice">' +
    "</div>" +
    '<h1 id="firstHeading" class="firstHeading">Description</h1>' +
    '<div id="bodyContent">' +
    "(Nice description).</p>" +
    "</div>" +
    "</div>";

  const infowindow = new google.maps.InfoWindow({
    content: contentString,
  });

  const marker = new google.maps.Marker({
    position: uluru,
    map,
    title: "Uluru (Ayers Rock)",
  });
  marker.addListener("click", () => {
    infowindow.open(map, marker);
  });


  let currentAddresses = [
    "Rue Signaï, Québec, QC G1K 5L8, Canada",
    "472 Ch Ste-Foy, Québec, QC G1S 2J5, Canada",
    "656 Champlain, Québec, QC, G1K 4J3",
    "636-640, Grande Allée Ouest, Québec, QC, G1S 1B8",
    "Grande Allée Ouest, Québec, QC, G1S 1B6",
    "1046 Avenue des Érables, Québec, QC G1R 2M9, Canada",
    "472 Ch Ste-Foy, Québec, QC G1S 2J5, Canada",
    "6 Rue Couillard, Québec, QC G1R, Canada",
    "Grande Allée Ouest, Québec, QC, G1S 1B6",
    "636-640, Grande Allée Ouest, Québec, QC, G1S 1B8",
    "540 Rue Boisseau, Québec, QC G1N 1X2, Canada",
    "171 Boulevard René Levesque Ouest, G1R 2A6, Québec, QC",
    "127 Rue Saint-Ambroise, Québec, QC, G1R 3G4",
    "656 Rue Champlain, Québec, QC G1K 4J3, Canada",
    "Quebec City, QC G1R, Canada",
    "572 Rue D'Aiguillon, Québec, QC G1R 1M3, Canada",
    "51 Grande Allée E, Québec, QC G1R 2G6, Canada",
    "6 Rue Couillard, Québec, QC G1R, Canada",
    "940 avenue de Bourlamaque , Québec G1R 2N8 QC",
    "477 Boulevard René-Lévesque O, Québec, QC G1S 1S2, Canada",
    "263 8e Rue, Québec, QC G1L 2N8, Canada",
    "940 Avenue de Bourlamaque, Québec, QC G1R 2N8, Canada",
    "Quebec City, QC G1R2B1, Canada",
    "142 René Lévesque ouest, G1R 2A5, Quartier Montcalm, QC",
  ];

  const geocoder = new google.maps.Geocoder();

locations = [];

for (let address of currentAddresses){
    await geocode(address, map, geocoder);
}

}


const delay = time => new Promise(res=>setTimeout(res,time));

async function geocode(address, map, geocoder) {
    await delay(3000);
    console.log("geocode");
    geocoder.geocode({ address: address }, (results, status) => {
    if (status === "OK") {
        new google.maps.Marker({
        map: map,
        position: results[0].geometry.location,
    }); 
    } else {
    alert(
        "Geocode was not successful for the following reason: " + status
    );
    }
    map.setCenter(results[0].geometry.location);
  }); 
}
    </script>
    <!-- jsFiddle will insert css and js -->
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>